#cloud-config
users:
  - name: sandbox
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCuDJXFgFJCDxZtUCKb2/l/xpbbxF1Al/tD7YKofu+72v3Kiimio03Zl1bXfnXTqPUh+F+1o+H52W/hQF8GWZjQZQX/xURwP9eC/bvtlzetqlMfgvtRjqxH5mWOs1RKFr3MGoRT/b8yWjyKFAfBkcUz1plRazdSA4D//oyWYvZ24dDR/GZ6FxWQ92i2xGPeRefaHQH914dJQhOFBhCXdK7KM/De/ngLA6vqRDaFt69Eb9TO+o/1FUMTRodPV9jFoaAxzRrl3MbxZ7xEsUl1jdpU2jIIt0QazgFEhASFopiuFrcFSA8uu52cnMa2fJizLsoYTjlBlXm9DlbNIOgHChsADkNGpNYHGQvpf120GxHi27lArlk18ERM6qHKWJPVoIHkcmfV72s9HkLfF2Jicn8eoRNqmEVE2EFlz/wv2+ufDQHjMPKP3yYBA0LP6vh0oYG88jA4NxDJQpHe5h0abJCy7jHelYeFDjQxVHuKCWsMA2stqasH3370FrcedftLX0PSCOMZLwVf7IhJycaFRdcDRPo4dtYTLo8aQdttc21eHLORcFPyelF6cfFMMBfuQdmuloUHEi5/3s2MjX2Nm4nGiVQCYV/Cf+kdsQISBDSrQxULD2tyUC8F5g531HDkKHN1hcL/WZmw1JjW+bemhbuktVf68oGrmBAEqRsh4QcA1w== slopspotter-sandbox
    lock_passwd: false

# Set password to 'sandbox123'
chpasswd:
  list: |
    sandbox:sandbox123
  expire: false

ssh_pwauth: true

package_update: true
package_upgrade: true

packages:
  - python3
  - python3-pip
  - python3-venv
  - nodejs
  - npm
  - strace
  - tcpdump
  - git
  - curl
  - wget
  - build-essential
  - qemu-guest-agent

runcmd:
  - systemctl enable ssh
  - systemctl start ssh
  - systemctl enable qemu-guest-agent
  - systemctl start qemu-guest-agent
  - pip3 install --upgrade pip
  - pip3 install psutil
  - npm install -g npm@latest
  - echo "VM initialization complete" > /tmp/init-complete
  - date > /tmp/init-timestamp

final_message: "Slopspotter sandbox VM is ready!"
